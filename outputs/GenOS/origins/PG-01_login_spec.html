<!DOCTYPE html>
<html lang="ko" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenOS — 로그인 [SPEC OVERLAY] | 금융권 AI 보안 플랫폼</title>

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="../cdn/tailwind.css">
    <!-- Alpine.js -->
    <script defer src="../cdn/alpine.js"></script>
    <!-- Lucide Icons -->
    <script src="../cdn/lucide.js"></script>

    <style>
        .hero-pattern {
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.04) 1px, transparent 0);
            background-size: 24px 24px;
        }
        .otp-box {
            width: 48px; height: 56px;
            text-align: center; font-size: 1.25rem; font-weight: 600;
            border-radius: 0.5rem; border: 1px solid #e2e8f0; background: #fff;
            outline: none; transition: all 0.15s;
        }
        .otp-box:focus { border-color: #0f172a; box-shadow: 0 0 0 2px rgba(15,23,42,0.15); }
        .otp-box.filled { border-color: #94a3b8; background: #f8fafc; }

        @keyframes slideInRight { from { opacity:0; transform:translateX(16px); } to { opacity:1; transform:translateX(0); } }
        @keyframes progressBar { from { width:0; } to { width:100%; } }
        .slide-in { animation: slideInRight 0.3s ease-out forwards; }
        .progress-anim { animation: progressBar 1.8s ease-in-out forwards; }

        /* ============ SPEC OVERLAY STYLES ============ */
        .spec-overlay-toggle {
            position: fixed; top: 12px; right: 12px; z-index: 99999;
            display: flex; align-items: center; gap: 8px;
            background: #dc2626; color: #fff; border: none;
            padding: 8px 16px; border-radius: 8px; font-size: 13px;
            font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(220,38,38,0.35);
            transition: all 0.2s;
        }
        .spec-overlay-toggle:hover { background: #b91c1c; transform: translateY(-1px); }
        .spec-overlay-toggle .dot { width: 8px; height: 8px; border-radius: 50%; background: #fca5a5; animation: blink 1.5s infinite; }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

        .spec-badge {
            position: absolute; z-index: 9999;
            background: #fff; border: 2px solid #dc2626; border-radius: 8px;
            padding: 10px 14px; max-width: 340px; min-width: 200px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 12px; line-height: 1.5; color: #1e293b;
            pointer-events: auto;
        }
        .spec-badge::before {
            content: ''; position: absolute; top: -7px; left: 16px;
            width: 12px; height: 12px; background: #fff;
            border-left: 2px solid #dc2626; border-top: 2px solid #dc2626;
            transform: rotate(45deg);
        }
        .spec-badge.arrow-right::before { left: auto; right: 16px; }
        .spec-badge.arrow-bottom::before { top: auto; bottom: -7px; transform: rotate(225deg); }
        .spec-badge.arrow-left::before { left: -7px; top: 16px; border-left: 2px solid #dc2626; border-top: none; border-bottom: 2px solid #dc2626; transform: rotate(45deg); }

        .spec-badge-header {
            display: flex; align-items: center; gap: 6px; margin-bottom: 6px;
        }
        .spec-badge-tag {
            background: #dc2626; color: #fff; font-size: 10px; font-weight: 700;
            padding: 2px 6px; border-radius: 4px; letter-spacing: 0.5px;
        }
        .spec-badge-component {
            font-weight: 700; color: #dc2626; font-size: 13px;
        }
        .spec-badge-type {
            color: #64748b; font-size: 10px; font-weight: 500;
        }
        .spec-badge-desc {
            color: #334155; margin-bottom: 6px; font-size: 11.5px;
        }
        .spec-badge-section {
            margin-top: 6px; padding-top: 6px; border-top: 1px dashed #e2e8f0;
        }
        .spec-badge-label {
            font-weight: 700; color: #dc2626; font-size: 10px; text-transform: uppercase;
            letter-spacing: 0.5px; margin-bottom: 2px;
        }
        .spec-badge-val {
            color: #475569; font-size: 11px;
        }
        .spec-badge-field {
            display: inline-flex; align-items: center; gap: 3px;
            background: #fef2f2; border: 1px solid #fecaca; border-radius: 3px;
            padding: 1px 5px; font-size: 10px; font-weight: 600; color: #991b1b;
            margin: 1px 2px;
        }
        .spec-badge-api {
            background: #f1f5f9; border-radius: 4px; padding: 4px 8px;
            font-family: 'SF Mono', 'Fira Code', monospace; font-size: 10.5px;
            color: #334155; margin-top: 4px;
        }

        .spec-highlight {
            outline: 2px dashed #dc2626 !important;
            outline-offset: 3px;
            position: relative;
        }

        .spec-hidden { display: none !important; }

        /* Page-level info banner */
        .spec-page-banner {
            position: fixed; top: 56px; right: 12px; z-index: 99998;
            background: #fff; border: 2px solid #dc2626; border-radius: 10px;
            padding: 14px 18px; max-width: 360px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            font-size: 12px; color: #1e293b;
        }
    </style>
</head>
<body class="h-full bg-white font-sans antialiased">

<!-- ============ SPEC OVERLAY TOGGLE BUTTON ============ -->
<button class="spec-overlay-toggle" onclick="toggleSpec()" id="specToggle">
    <span class="dot"></span>
    SPEC 오버레이 ON
</button>

<!-- ============ PAGE-LEVEL SPEC BANNER ============ -->
<div class="spec-page-banner" id="specBanner">
    <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
        <span class="spec-badge-tag">PG-01</span>
        <span style="font-weight:700;font-size:14px;">로그인</span>
        <span class="spec-badge-type">Phase 1 (MVP)</span>
    </div>
    <div class="spec-badge-desc" style="font-size:12px;">SSO(SAML 2.0/OIDC) 기반 인증 + MFA 필수 적용으로 금융사 보안 요건 충족</div>
    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <span class="spec-badge-field">P1 김부장 · IT보안</span>
        <span class="spec-badge-field">P2 이과장 · 디지털혁신PM</span>
        <span class="spec-badge-field">P3 CSM/PM</span>
    </div>
    <div style="margin-top:8px;font-size:10px;color:#64748b;">
        컴포넌트: LoginForm · SSOProviderList · MFAVerification
    </div>
</div>

<!-- ============ MAIN APP (원본과 동일) ============ -->
<div x-data="loginApp()" class="flex h-full min-h-screen">

    <!-- ==================== LEFT HERO PANEL ==================== -->
    <div class="hidden lg:flex lg:w-[480px] xl:w-[560px] flex-col justify-between bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 text-white p-10 hero-pattern relative overflow-hidden">
        <div class="absolute top-0 right-0 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
        <div class="absolute bottom-0 left-0 w-72 h-72 bg-indigo-500/10 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"></div>
        <div class="relative z-10">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-white/10 backdrop-blur flex items-center justify-center">
                    <i data-lucide="shield-check" class="w-6 h-6 text-blue-400"></i>
                </div>
                <span class="text-2xl font-bold tracking-tight">GenOS</span>
            </div>
            <p class="text-slate-400 text-sm ml-[52px] mt-0.5">Financial AI Security Platform</p>
        </div>
        <div class="relative z-10 -mt-8">
            <h1 class="text-3xl xl:text-[2.5rem] font-bold leading-tight mb-6">금융을 위한<br><span class="text-blue-400">AI 보안 플랫폼</span></h1>
            <p class="text-slate-400 text-[15px] leading-relaxed mb-10">AI 기반 이상거래 탐지부터 컴플라이언스 리포팅까지,<br>금융 보안의 모든 것을 하나의 플랫폼에서.</p>
            <div class="space-y-4">
                <div class="flex items-start gap-3"><div class="w-8 h-8 rounded-md bg-blue-500/10 flex items-center justify-center flex-shrink-0 mt-0.5"><i data-lucide="brain" class="w-4 h-4 text-blue-400"></i></div><div><p class="text-sm font-medium">AI 에이전트 기반 이상 탐지</p><p class="text-xs text-slate-500 mt-0.5">딥러닝 모델로 실시간 이상거래 패턴 식별</p></div></div>
                <div class="flex items-start gap-3"><div class="w-8 h-8 rounded-md bg-emerald-500/10 flex items-center justify-center flex-shrink-0 mt-0.5"><i data-lucide="activity" class="w-4 h-4 text-emerald-400"></i></div><div><p class="text-sm font-medium">실시간 보안 모니터링</p><p class="text-xs text-slate-500 mt-0.5">24/7 보안 위협 모니터링 및 자동 대응</p></div></div>
                <div class="flex items-start gap-3"><div class="w-8 h-8 rounded-md bg-amber-500/10 flex items-center justify-center flex-shrink-0 mt-0.5"><i data-lucide="file-check" class="w-4 h-4 text-amber-400"></i></div><div><p class="text-sm font-medium">금융보안원 컴플라이언스</p><p class="text-xs text-slate-500 mt-0.5">규제 준수 자동 리포트 생성 및 감사 추적</p></div></div>
                <div class="flex items-start gap-3"><div class="w-8 h-8 rounded-md bg-purple-500/10 flex items-center justify-center flex-shrink-0 mt-0.5"><i data-lucide="server" class="w-4 h-4 text-purple-400"></i></div><div><p class="text-sm font-medium">99.95% SLA 보장</p><p class="text-xs text-slate-500 mt-0.5">이중화 아키텍처 및 DR 자동 전환</p></div></div>
            </div>
        </div>
        <div class="relative z-10">
            <div class="flex items-center gap-2 text-xs text-slate-500"><i data-lucide="lock" class="w-3 h-3"></i><span>TLS 1.3 암호화 통신 · SOC 2 Type II 인증</span></div>
            <p class="text-xs text-slate-600 mt-2">&copy; 2026 GenOS Inc. All rights reserved.</p>
        </div>
    </div>

    <!-- ==================== RIGHT AUTH PANEL ==================== -->
    <div class="flex-1 flex items-center justify-center p-6 sm:p-8 lg:p-12 bg-white">
        <div class="w-full max-w-[400px]" style="position:relative;">

            <!-- Mobile logo -->
            <div class="lg:hidden flex items-center gap-2 mb-8">
                <div class="w-8 h-8 rounded-lg bg-slate-900 flex items-center justify-center"><i data-lucide="shield-check" class="w-5 h-5 text-white"></i></div>
                <span class="text-xl font-bold text-slate-900">GenOS</span>
            </div>

            <!-- ========== STEP 1 : LOGIN ========== -->
            <div x-show="step === 'login'" x-transition:enter="slide-in">

                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 tracking-tight">로그인</h2>
                    <p class="text-sm text-slate-500 mt-1.5">GenOS 계정으로 로그인하세요</p>
                </div>

                <!-- Lockout banner -->
                <div x-show="isLocked" x-transition class="mb-6 rounded-lg bg-red-50 border border-red-200 p-4">
                    <div class="flex gap-3">
                        <i data-lucide="alert-triangle" class="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"></i>
                        <div>
                            <p class="text-sm font-medium text-red-800">계정이 일시 잠겨있습니다</p>
                            <p class="text-xs text-red-600 mt-1">로그인 시도 횟수를 초과했습니다. <span x-text="formatTimer(lockoutTimer)"></span> 후 다시 시도해주세요.</p>
                        </div>
                    </div>
                </div>

                <!-- ★ SPEC: LoginForm Component ★ -->
                <div style="position:relative;" id="spec-loginform">
                    <!-- SPEC BADGE: LoginForm -->
                    <div class="spec-badge spec-item arrow-bottom" style="bottom: calc(100% + 12px); left: -20px; right: -20px; max-width: none;">
                        <div class="spec-badge-header">
                            <span class="spec-badge-tag">COMP</span>
                            <span class="spec-badge-component">LoginForm</span>
                            <span class="spec-badge-type">Form</span>
                        </div>
                        <div class="spec-badge-desc">이메일/비밀번호 입력을 통한 기본 인증 폼 (SSO 미사용 시 폴백)</div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Fields</div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="spec-badge-field">email: text (필수)</span>
                                <span class="spec-badge-field">password: password (필수)</span>
                                <span class="spec-badge-field">remember_device: toggle</span>
                            </div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Validation</div>
                            <div class="spec-badge-val">이메일: RFC 5322 형식 검증. 비밀번호: 금융보안원 권고 12자 이상, 대/소문자·숫자·특수문자 조합 필수. 빈 필드 제출 시 필드별 에러 표시.</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Interaction</div>
                            <div class="spec-badge-val">이메일 입력 후 Tab 키로 비밀번호 필드 이동, Enter 키로 로그인 실행. 로그인 성공 시 MFA 단계로 전환. 실패 시 인라인 에러 표시.</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Error State</div>
                            <div class="spec-badge-val">필드 하단 인라인 에러 메시지 + 5회 실패 시 계정 잠금 안내 배너</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Loading State</div>
                            <div class="spec-badge-val">로그인 버튼에 spinner 표시 + 버튼 비활성화</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">API Binding</div>
                            <div class="spec-badge-api">POST /api/v1/auth/login → {session_token, user_id, mfa_required, mfa_methods}</div>
                            <div class="spec-badge-val" style="margin-top:3px;">Error: 400(형식오류) · 401(인증실패) · 403(계정잠금) · 429(시도초과) · 500(서버오류)</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Accessibility</div>
                            <div class="spec-badge-val">aria-label: "GenOS 로그인 폼" · 키보드 네비게이션 · focus-order: 1 · 고대비 지원</div>
                        </div>
                    </div>

                    <!-- Login form (원본) -->
                    <form @submit.prevent="handleLogin" class="space-y-4 spec-highlight spec-item">
                        <div>
                            <label for="email" class="block text-sm font-medium text-slate-700 mb-1.5">이메일</label>
                            <div class="relative">
                                <input id="email" type="email" x-model="email" @blur="validateEmail"
                                    class="flex h-10 w-full rounded-md border bg-white px-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-150"
                                    :class="emailError ? 'border-red-400 focus:ring-red-500' : 'border-slate-200 focus:ring-slate-900'"
                                    :disabled="isLocked || isLoading" placeholder="업무용 이메일 주소" autocomplete="email" aria-label="이메일 주소">
                                <div x-show="email && !emailError" class="absolute right-3 top-1/2 -translate-y-1/2"><i data-lucide="check-circle-2" class="w-4 h-4 text-emerald-500"></i></div>
                            </div>
                            <p x-show="emailError" x-text="emailError" class="text-xs text-red-500 mt-1.5"></p>
                        </div>

                        <div>
                            <div class="flex items-center justify-between mb-1.5">
                                <label for="password" class="text-sm font-medium text-slate-700">비밀번호</label>
                                <button type="button" @click="forgotPassword" class="text-xs text-slate-500 hover:text-slate-900 transition-colors">비밀번호를 잊으셨나요?</button>
                            </div>
                            <div class="relative">
                                <input id="password" :type="showPassword ? 'text' : 'password'" x-model="password" @blur="validatePassword" @input="calcStrength"
                                    class="flex h-10 w-full rounded-md border bg-white px-3 py-2 pr-10 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-150"
                                    :class="passwordError ? 'border-red-400 focus:ring-red-500' : 'border-slate-200 focus:ring-slate-900'"
                                    :disabled="isLocked || isLoading" autocomplete="current-password" aria-label="비밀번호">
                                <button type="button" @click="togglePassword" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
                                    <svg x-show="!showPassword" class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/></svg>
                                    <svg x-show="showPassword" class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12c1.292 4.338 5.31 7.5 10.066 7.5.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"/></svg>
                                </button>
                            </div>
                            <p x-show="passwordError" x-text="passwordError" class="text-xs text-red-500 mt-1.5"></p>
                            <div x-show="password.length > 0 && !passwordError" class="mt-2">
                                <div class="flex gap-1">
                                    <template x-for="i in 4" :key="i"><div class="h-1 flex-1 rounded-full transition-colors duration-300" :class="i <= strengthLevel ? strengthColor : 'bg-slate-200'"></div></template>
                                </div>
                                <p class="text-xs mt-1 transition-colors" :class="strengthTextColor" x-text="strengthText"></p>
                            </div>
                        </div>

                        <div class="flex items-center gap-2">
                            <button type="button" role="checkbox" :aria-checked="rememberDevice.toString()" @click="rememberDevice = !rememberDevice"
                                class="w-4 h-4 rounded border flex items-center justify-center transition-colors focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-1"
                                :class="rememberDevice ? 'bg-slate-900 border-slate-900' : 'bg-white border-slate-300'">
                                <svg x-show="rememberDevice" class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>
                            </button>
                            <label @click="rememberDevice = !rememberDevice" class="text-sm text-slate-600 cursor-pointer select-none">이 기기 기억하기</label>
                        </div>

                        <button type="submit"
                            class="inline-flex items-center justify-center h-10 w-full rounded-md bg-slate-900 px-4 py-2 text-sm font-medium text-white hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-1 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150 mt-2"
                            :disabled="isLocked || isLoading">
                            <svg x-show="isLoading" class="animate-spin -ml-1 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            <span x-text="isLoading ? '로그인 중...' : '로그인'"></span>
                        </button>
                    </form>
                </div>

                <!-- Divider -->
                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-200"></div></div>
                    <div class="relative flex justify-center text-xs"><span class="bg-white px-3 text-slate-400">또는</span></div>
                </div>

                <!-- ★ SPEC: SSOProviderList Component ★ -->
                <div style="position:relative;" id="spec-ssoproviderlist">
                    <div class="space-y-2.5 spec-highlight spec-item">
                        <button @click="handleSSO('KB국민은행')" :disabled="isLocked || isLoading"
                            class="inline-flex items-center justify-center gap-2 h-10 w-full rounded-md border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 hover:border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-1 transition-all duration-150 disabled:opacity-50"
                            aria-label="KB국민은행 SSO로 로그인"><i data-lucide="landmark" class="w-4 h-4 text-slate-500"></i>KB국민은행으로 로그인</button>
                        <button @click="handleSSO('신한은행')" :disabled="isLocked || isLoading"
                            class="inline-flex items-center justify-center gap-2 h-10 w-full rounded-md border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 hover:border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-1 transition-all duration-150 disabled:opacity-50"
                            aria-label="신한은행 SSO로 로그인"><i data-lucide="building-2" class="w-4 h-4 text-slate-500"></i>신한은행으로 로그인</button>
                        <button @click="handleSSO('NH농협은행')" :disabled="isLocked || isLoading"
                            class="inline-flex items-center justify-center gap-2 h-10 w-full rounded-md border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 hover:border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-1 transition-all duration-150 disabled:opacity-50"
                            aria-label="NH농협은행 SSO로 로그인"><i data-lucide="wheat" class="w-4 h-4 text-slate-500"></i>NH농협은행으로 로그인</button>
                    </div>

                    <!-- SPEC BADGE: SSOProviderList -->
                    <div class="spec-badge spec-item" style="top: calc(100% + 12px); left: -20px; right: -20px; max-width: none;">
                        <div class="spec-badge-header">
                            <span class="spec-badge-tag">COMP</span>
                            <span class="spec-badge-component">SSOProviderList</span>
                            <span class="spec-badge-type">ButtonGroup</span>
                        </div>
                        <div class="spec-badge-desc">고객사 IdP(SAML 2.0/OIDC) 기반 SSO 로그인 버튼 목록</div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Items</div>
                            <div class="spec-badge-val">sso_provider_button: "{{provider_name}}으로 로그인" · variant: outline · action: redirect_to_idp</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Interaction</div>
                            <div class="spec-badge-val">SSO 버튼 클릭 시 해당 IdP 로그인 페이지로 리다이렉트. 인증 완료 후 콜백 URL로 복귀하여 MFA 단계 진입.</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Empty State</div>
                            <div class="spec-badge-val">SSO가 설정되지 않았습니다. 관리자에게 SSO 연동을 요청하세요.</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Error State</div>
                            <div class="spec-badge-val">"일시적 오류로 SSO를 사용할 수 없습니다. 이메일/비밀번호로 로그인해주세요." + 재시도 버튼</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">API Binding</div>
                            <div class="spec-badge-api">GET /api/v1/auth/sso/providers → {provider_id, provider_name, provider_type, icon_url, login_url}</div>
                            <div class="spec-badge-val" style="margin-top:3px;">auto_retry: true · max_attempts: 3 · backoff: exponential · cache: local</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Accessibility</div>
                            <div class="spec-badge-val">aria-label: "SSO 로그인 제공자 목록" · 방향키 탐색 · focus-order: 2</div>
                        </div>
                    </div>
                </div>

                <p class="text-center text-xs text-slate-400 mt-8">계정이 없으신가요? <a href="#" class="text-slate-600 hover:text-slate-900 font-medium transition-colors">관리자에게 문의하세요</a></p>
            </div>

            <!-- ========== STEP 2 : MFA ========== -->
            <div x-show="step === 'mfa'" x-transition:enter="slide-in" style="display:none;">

                <button @click="backToLogin" class="inline-flex items-center gap-1.5 text-sm text-slate-500 hover:text-slate-900 transition-colors mb-6"><i data-lucide="arrow-left" class="w-4 h-4"></i>로그인으로 돌아가기</button>

                <div class="mb-8">
                    <div class="w-12 h-12 rounded-xl bg-slate-100 flex items-center justify-center mb-4"><i data-lucide="shield-check" class="w-6 h-6 text-slate-700"></i></div>
                    <h2 class="text-2xl font-bold text-slate-900 tracking-tight">2차 인증</h2>
                    <p class="text-sm text-slate-500 mt-1.5">보안을 위해 추가 인증이 필요합니다</p>
                </div>

                <!-- ★ SPEC: MFAVerification Component ★ -->
                <div style="position:relative;" id="spec-mfaverification">
                    <!-- SPEC BADGE: MFAVerification -->
                    <div class="spec-badge spec-item arrow-bottom" style="bottom: calc(100% + 12px); left: -20px; right: -20px; max-width: none;">
                        <div class="spec-badge-header">
                            <span class="spec-badge-tag">COMP</span>
                            <span class="spec-badge-component">MFAVerification</span>
                            <span class="spec-badge-type">Form</span>
                        </div>
                        <div class="spec-badge-desc">MFA 2차 인증 (TOTP 앱 또는 SMS OTP) 입력 폼 — 1차 인증 성공 후 표시</div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Fields</div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="spec-badge-field">mfa_method: select (필수) [TOTP, SMS]</span>
                                <span class="spec-badge-field">otp_code: text (필수) ^[0-9]{6}$</span>
                            </div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Interaction</div>
                            <div class="spec-badge-val">1차 인증 성공 시 자동 표시. OTP 입력 필드에 자동 포커스. 6자리 입력 완료 시 자동 제출. 인증 실패 시 남은 시도 횟수 표시. 3회 실패 시 5분 대기.</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Validation</div>
                            <div class="spec-badge-val">OTP: 정확히 6자리 숫자. 유효 시간 30초(TOTP) / 3분(SMS). 만료 시 재전송 유도.</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Error State</div>
                            <div class="spec-badge-val">"인증 코드가 올바르지 않습니다. (남은 시도: N회)" · 3회 초과: "보안을 위해 5분 후 다시 시도해주세요." 배너</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">API Binding</div>
                            <div class="spec-badge-api">POST /api/v1/auth/mfa/verify → {access_token, refresh_token, expires_in, user}</div>
                            <div class="spec-badge-val" style="margin-top:3px;">timeout: 10000ms · retry: 3회(exponential)</div>
                        </div>

                        <div class="spec-badge-section">
                            <div class="spec-badge-label">Accessibility</div>
                            <div class="spec-badge-val">aria-label: "다중 인증(MFA) 확인 폼" · focus-order: 3 · screen-reader: "2차 인증이 필요합니다"</div>
                        </div>
                    </div>

                    <!-- MFA method selector -->
                    <div class="mb-6 spec-highlight spec-item">
                        <label class="block text-sm font-medium text-slate-700 mb-2">인증 방법</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button @click="selectMfaMethod('TOTP')" class="rounded-lg border p-3 text-center transition-all focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-1" :class="mfaMethod === 'TOTP' ? 'border-slate-900 bg-slate-50 text-slate-900' : 'border-slate-200 text-slate-500 hover:border-slate-300'"><i data-lucide="smartphone" class="w-5 h-5 mx-auto mb-1"></i><p class="text-xs font-medium">인증 앱 (TOTP)</p></button>
                            <button @click="selectMfaMethod('SMS')" class="rounded-lg border p-3 text-center transition-all focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-1" :class="mfaMethod === 'SMS' ? 'border-slate-900 bg-slate-50 text-slate-900' : 'border-slate-200 text-slate-500 hover:border-slate-300'"><i data-lucide="message-square" class="w-5 h-5 mx-auto mb-1"></i><p class="text-xs font-medium">SMS OTP</p></button>
                        </div>
                    </div>

                    <div x-show="mfaError" x-transition class="mb-4 rounded-lg bg-red-50 border border-red-200 p-3">
                        <div class="flex gap-2"><i data-lucide="x-circle" class="w-4 h-4 text-red-500 flex-shrink-0 mt-0.5"></i><p class="text-sm text-red-700" x-text="mfaError"></p></div>
                    </div>

                    <form @submit.prevent="handleMFA" class="space-y-5">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">인증 코드</label>
                            <p class="text-xs text-slate-400 mb-3" x-text="mfaMethod === 'TOTP' ? '인증 앱에 표시된 6자리 코드를 입력하세요' : '010-****-1234로 전송된 6자리 코드를 입력하세요'"></p>
                            <div class="flex gap-2 justify-center" role="group" aria-label="6자리 인증 코드 입력">
                                <template x-for="(digit, idx) in otpDigits" :key="idx">
                                    <input type="text" inputmode="numeric" maxlength="1" :id="'otp-' + idx" :value="digit" @input="onOtpInput($event, idx)" @keydown="onOtpKeydown($event, idx)" @paste="onOtpPaste($event)" @focus="$event.target.select()" class="otp-box" :class="digit ? 'filled' : ''" :disabled="mfaLocked || isLoading" :aria-label="'인증 코드 ' + (idx+1) + '번째 자리'">
                                </template>
                            </div>
                        </div>

                        <div class="flex items-center justify-center gap-2 text-sm"><i data-lucide="clock" class="w-4 h-4 text-slate-400"></i><span :class="otpTimer <= 10 ? 'text-red-500 font-medium' : 'text-slate-500'" x-text="formatTimer(otpTimer)"></span></div>

                        <div x-show="mfaLocked" x-transition class="rounded-lg bg-amber-50 border border-amber-200 p-3">
                            <div class="flex gap-2"><i data-lucide="timer" class="w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"></i><p class="text-sm text-amber-700">보안을 위해 <span x-text="formatTimer(mfaLockTimer)" class="font-medium"></span> 후 다시 시도해주세요.</p></div>
                        </div>

                        <button type="submit" class="inline-flex items-center justify-center h-10 w-full rounded-md bg-slate-900 px-4 py-2 text-sm font-medium text-white hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-1 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150" :disabled="otpDigits.join('').length < 6 || mfaLocked || isLoading">
                            <svg x-show="isLoading" class="animate-spin -ml-1 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            <span x-text="isLoading ? '인증 확인 중...' : '인증 확인'"></span>
                        </button>

                        <div class="flex items-center justify-between text-xs">
                            <button type="button" @click="resendOTP" class="text-slate-500 hover:text-slate-900 transition-colors disabled:opacity-40" :disabled="mfaMethod === 'SMS' && otpTimer > 0">인증 코드 재전송</button>
                            <button type="button" @click="switchMfaMethod" class="text-slate-500 hover:text-slate-900 transition-colors">다른 인증 방법 사용</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ========== STEP 3 : SUCCESS ========== -->
            <div x-show="step === 'success'" x-transition style="display:none;">
                <div class="text-center py-8 slide-in">
                    <div class="w-16 h-16 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-4"><i data-lucide="check" class="w-8 h-8 text-emerald-600"></i></div>
                    <h2 class="text-xl font-bold text-slate-900">인증 완료</h2>
                    <p class="text-sm text-slate-500 mt-2"><span x-text="userName"></span>님, 환영합니다.<br>대시보드로 이동합니다...</p>
                    <div class="mt-6"><div class="h-1 w-48 bg-slate-100 rounded-full mx-auto overflow-hidden"><div class="h-full bg-slate-900 rounded-full progress-anim"></div></div></div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
document.addEventListener('alpine:init', () => {
    setTimeout(() => lucide.createIcons(), 50);
});

/* ============ SPEC OVERLAY TOGGLE ============ */
let specVisible = true;
function toggleSpec() {
    specVisible = !specVisible;
    const items = document.querySelectorAll('.spec-item, .spec-highlight, .spec-page-banner');
    items.forEach(el => {
        if (specVisible) {
            el.classList.remove('spec-hidden');
            if (el.classList.contains('spec-highlight')) {
                el.style.outline = '2px dashed #dc2626';
                el.style.outlineOffset = '3px';
            }
        } else {
            el.classList.add('spec-hidden');
            if (el.classList.contains('spec-highlight')) {
                el.style.outline = 'none';
            }
        }
    });
    const banner = document.getElementById('specBanner');
    if (banner) banner.style.display = specVisible ? '' : 'none';
    const btn = document.getElementById('specToggle');
    btn.innerHTML = specVisible
        ? '<span class="dot"></span> SPEC 오버레이 ON'
        : '<span class="dot" style="background:#86efac;"></span> SPEC 오버레이 OFF';
    btn.style.background = specVisible ? '#dc2626' : '#475569';
}

function loginApp() {
    return {
        step: 'login', email: '', password: '', rememberDevice: false, showPassword: false,
        mfaMethod: 'TOTP', otpDigits: ['', '', '', '', '', ''],
        emailError: '', passwordError: '', mfaError: '',
        isLoading: false, loginAttempts: 0, mfaAttempts: 0,
        isLocked: false, lockoutTimer: 0, mfaLocked: false, mfaLockTimer: 0,
        otpTimer: 30, _otpInterval: null,
        strengthLevel: 0, strengthColor: 'bg-slate-200', strengthTextColor: 'text-slate-400', strengthText: '',
        userName: '김부장',

        validateEmail() {
            if (!this.email) { this.emailError = ''; return false; }
            if (!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(this.email)) { this.emailError = '올바른 이메일 형식을 입력해주세요'; return false; }
            this.emailError = ''; return true;
        },
        validatePassword() {
            if (!this.password) { this.passwordError = ''; return false; }
            if (this.password.length < 12) { this.passwordError = '12자 이상 입력해주세요'; return false; }
            if (!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{12,}$/.test(this.password)) { this.passwordError = '대/소문자·숫자·특수문자를 포함해야 합니다'; return false; }
            this.passwordError = ''; return true;
        },
        calcStrength() {
            const pw = this.password; let lv = 0;
            if (pw.length >= 8) lv++; if (pw.length >= 12) lv++;
            if (/[A-Z]/.test(pw) && /[a-z]/.test(pw)) lv++;
            if (/\d/.test(pw) && /[@$!%*?&]/.test(pw)) lv++;
            this.strengthLevel = lv;
            const c = ['bg-red-500','bg-orange-500','bg-amber-500','bg-emerald-500'];
            const tc = ['text-red-500','text-orange-500','text-amber-500','text-emerald-500'];
            const t = ['매우 약함','약함','보통','강함'];
            this.strengthColor = c[Math.max(0,lv-1)] || 'bg-slate-200';
            this.strengthTextColor = tc[Math.max(0,lv-1)] || 'text-slate-400';
            this.strengthText = lv > 0 ? t[lv-1] : '';
        },
        togglePassword() { this.showPassword = !this.showPassword; },
        async handleLogin() {
            if (this.isLocked || this.isLoading) return;
            const eOk = this.validateEmail(); const pOk = this.validatePassword();
            if (!eOk || !pOk) { if (!this.email) this.emailError = '이메일을 입력해주세요'; if (!this.password) this.passwordError = '비밀번호를 입력해주세요'; return; }
            this.isLoading = true; await new Promise(r => setTimeout(r, 1400)); this.isLoading = false; this.loginAttempts++;
            if (this.email === 'fail@test.com') { if (this.loginAttempts >= 5) { this.isLocked = true; this.lockoutTimer = 300; this._startLockout(); return; } this.passwordError = `이메일 또는 비밀번호가 올바르지 않습니다 (${this.loginAttempts}/5)`; return; }
            this.loginAttempts = 0; this.step = 'mfa'; this._startOtp();
            this.$nextTick(() => { document.getElementById('otp-0')?.focus(); lucide.createIcons(); });
        },
        handleSSO(name) {
            if (this.isLocked || this.isLoading) return;
            this.isLoading = true;
            setTimeout(() => { this.isLoading = false; this.step = 'mfa'; this._startOtp(); this.$nextTick(() => { document.getElementById('otp-0')?.focus(); lucide.createIcons(); }); }, 1000);
        },
        async handleMFA() {
            const code = this.otpDigits.join('');
            if (code.length < 6 || this.mfaLocked || this.isLoading) return;
            this.isLoading = true; this.mfaError = ''; await new Promise(r => setTimeout(r, 1200)); this.isLoading = false;
            if (code !== '123456') { this.mfaAttempts++; if (this.mfaAttempts >= 3) { this.mfaLocked = true; this.mfaLockTimer = 300; this.mfaError = '보안을 위해 5분 후 다시 시도해주세요.'; this._startMfaLock(); } else { this.mfaError = `인증 코드가 올바르지 않습니다. (남은 시도: ${3-this.mfaAttempts}회)`; } this.otpDigits = ['','','','','','']; this.$nextTick(() => document.getElementById('otp-0')?.focus()); return; }
            this._stopOtp(); this.step = 'success'; this.$nextTick(() => lucide.createIcons());
            setTimeout(() => { window.location.href = 'PG-02_dashboard.html'; }, 2200);
        },
        onOtpInput(e, idx) { const v = e.target.value.replace(/\D/g, ''); this.otpDigits[idx] = v ? v[v.length-1] : ''; e.target.value = this.otpDigits[idx]; if (v && idx < 5) document.getElementById('otp-'+(idx+1))?.focus(); if (this.otpDigits.every(d => d !== '')) this.handleMFA(); },
        onOtpKeydown(e, idx) { if (e.key === 'Backspace' && !this.otpDigits[idx] && idx > 0) document.getElementById('otp-'+(idx-1))?.focus(); },
        onOtpPaste(e) { e.preventDefault(); const txt = (e.clipboardData||window.clipboardData).getData('text').replace(/\D/g,''); for (let i=0;i<Math.min(txt.length,6);i++) this.otpDigits[i]=txt[i]; const fi=Math.min(txt.length,5); this.$nextTick(()=>document.getElementById('otp-'+fi)?.focus()); if(this.otpDigits.every(d=>d!=='')) this.handleMFA(); },
        selectMfaMethod(m) { this.mfaMethod = m; this.otpDigits = ['','','','','','']; this.mfaError = ''; this.otpTimer = m === 'SMS' ? 180 : 30; this._startOtp(); this.$nextTick(()=>document.getElementById('otp-0')?.focus()); },
        switchMfaMethod() { this.selectMfaMethod(this.mfaMethod === 'TOTP' ? 'SMS' : 'TOTP'); },
        resendOTP() { this.otpDigits = ['','','','','','']; this.mfaError = ''; this.otpTimer = this.mfaMethod === 'SMS' ? 180 : 30; this._startOtp(); this.$nextTick(()=>document.getElementById('otp-0')?.focus()); },
        _startOtp() { this._stopOtp(); this._otpInterval = setInterval(() => { this.otpTimer--; if (this.otpTimer <= 0) this._stopOtp(); }, 1000); },
        _stopOtp() { if (this._otpInterval) { clearInterval(this._otpInterval); this._otpInterval = null; } },
        _startLockout() { const iv = setInterval(() => { this.lockoutTimer--; if (this.lockoutTimer <= 0) { clearInterval(iv); this.isLocked = false; this.loginAttempts = 0; } }, 1000); },
        _startMfaLock() { const iv = setInterval(() => { this.mfaLockTimer--; if (this.mfaLockTimer <= 0) { clearInterval(iv); this.mfaLocked = false; this.mfaAttempts = 0; this.mfaError = ''; } }, 1000); },
        formatTimer(s) { const m = Math.floor(s/60), sec = s%60; return m > 0 ? `${m}:${String(sec).padStart(2,'0')}` : `${sec}초`; },
        backToLogin() { this._stopOtp(); this.otpDigits = ['','','','','','']; this.mfaError = ''; this.mfaAttempts = 0; this.step = 'login'; this.$nextTick(()=>lucide.createIcons()); },
        forgotPassword() { alert('비밀번호 재설정 이메일이 발송됩니다.'); },
        init() { this.$nextTick(() => lucide.createIcons()); }
    };
}
</script>
</body>
</html>
